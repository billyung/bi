
<style type="text/css">

#burndown {
	padding-left: 10px;
	padding-top: 10px;
	padding-right: 10px;
	display:none;
}

#toptableObj {
	padding-bottom: 10px;
}

#toptableObj th{
	padding-top: 5px;
	padding-bottom: 5px;
}

#toptableObj td{
	padding-top: 5px;
	padding-bottom: 5px;
	padding-right: 5px;
}

.boldLabel{
	color: black;
	padding-left: 5px;
	font-weight:bold;
	display: inline;
}

.sectionTable {
	border-collapse: collapse;
}

.borderSection {
      border-style: solid;
      border-width: 1px;
	padding: 0;
	vertical-align: text-top;
}

.viewAll {
	float: right;
}

.textlink {
	vertical-align: 30%;
}

.blueArrow {
	color: #5E99E3;
	font-size: 170%;
	display: inline;
	text-decoration: none;
}

</style>

<div id="burndown">

<div id=toptableObj></div>

<table width="100%">
<tr>
<td width="49%" class=borderSection>

			<table width="100%" class=sectionTable>
				<tr>
					<td><div class=boldLabel> COLLECTIONS:</div> Top 5 Branches Remaining
					</td>
				</tr>
				<tr>
					<td align="center">
						<div id=collectionObj></div>
					</td>
				</tr>
				<tr>
					<td>
						<div id=top5CollectionObj></div>
					</td>
				</tr>
				<tr>
					<td>
						<div class=viewAll>
							<a class=textlink href="#" onclick="linkToPage('Collections');return false;">View all branches</a>
							<a class=blueArrow href="#" onclick="linkToPage('Collections');return false;">&#x25B6;</a>
						</div>
					</td>
				</tr>
			</table>

</td>
<td width="2%"></td>
<td width="49%" class=borderSection>

			<table width="100%" class=sectionTable>
				<tr>
					<td><div class=boldLabel> DISBURSALS:</div> Top 5 Branches Remaining
					</td>
				</tr>
				<tr>
					<td align="center">
						<div id=disbursementObj></div>
					</td>
				</tr>
				<tr>
					<td>
						<div id=top5DisbursementObj></div>
					</td>
				</tr>
				<tr>
					<td>
						<div class=viewAll>
							<a class=textlink href="#" onclick="linkToPage('Disbursals');return false;">View all branches</a>
							<a class=blueArrow href="#" onclick="linkToPage('Disbursals');return false;">&#x25B6;</a>
						</div>

					</td>

				</tr>

			</table>
</td>

</tr>
</table>

</div>


<script language="javascript" type="text/javascript">

var lighterOrange = "#FCD5B5";
var darkOrange = "#F79646";
var darkBlue = "#4F81BD";
var white = "white";
var black = "black";
var oddRow = "#D0D8E8";
var evenRow = "#E9EDF4";
var topTableRows = "#FDEFE9";


var currentDate = '2010-09-01';
var currentDateUpdated = currentDate;
currentDateUpdated.replace(/-/g,'');

var solution = Dashboards.getQueryParameter("solution");
var path = Dashboards.getQueryParameter("path");
var cdaPath = solution + "/" + "CollectionsDisbursalsBurndown.cda";


Dashboards.globalcontext = false;


function linkToPage(pageName)
{
	linkTo = webAppPath + "/content/pentaho-cdf/RenderXCDF?solution=" + solution + "&path=" + path + "&action=" + pageName + ".xcdf&template=mantle";
	//window.location = linkTo;
	alert("Still In Progress");
}


  var MetaLayerVar = {
    toptableDef: {
      colHeaders: [" ", "Branches", "Centers", "Clients", "Collection", "Disbursement"],
      colTypes: ['string','numeric','numeric','numeric','numeric','numeric'],
	colFormats: [null, "%d", "%d", "%d", "%15.0f", "%15.0f"],
      tableStyle: "classic",
	paginate: false,
	sort: false,
	filter: false,
	info: false,
      dataAccessId: "getTargetAndCompleted", 
	path: cdaPath
    },

    branchDef: {
      colHeaders: ["Id", "Branches Remaining", "Expected", "Collected", "% Collected"],
      colTypes: ['numeric','string','numeric','numeric','numeric'],
	colFormats: [null, null, "%15.1f", "%15.1f", "%3.1f"],
      tableStyle: "classic",
	paginate: false,
	sort: false,
	filter: false,
	info: false,
      dataAccessId: "getRemainingBranchesCollection", 
	path: cdaPath
    },

    branchDefDisb: {
      colHeaders: ["Id", "Branches Remaining", "Expected", "Collected", "% Collected"],
      colTypes: ['numeric','string','numeric','numeric','numeric'],
	colFormats: [null, null, "%15.1f", "%15.1f", "%3.1f"],
      tableStyle: "classic",
	paginate: false,
	sort: false,
	filter: false,
	info: false,
      dataAccessId: "getRemainingBranchesDisbursement", 
	path: cdaPath
    }

  };


collection = {
	name:"collection", 
	type: "XactionComponent",
	solution: solution, 
	path: path,
	parameters:[["asOfDate", "currentDateUpdated"]],
	action: "collectionProgress.xaction",
	htmlObject: "collectionObj",
	executeAtStart: true
};

disbursement = {
	name:"disbursement", 
	type: "XactionComponent",
	solution: solution, 
	path: path,
	parameters:[["asOfDate", "currentDateUpdated"]],
	action: "disbursementProgress.xaction",
	htmlObject: "disbursementObj",
	executeAtStart: true
};


var toptable =
	{
 		name: "toptable",
		type: "tableComponent",
    		chartDefinition: MetaLayerVar.toptableDef,
		parameters: [["currentDate","currentDate"]],
		cdaParams: [["currentDate","currentDate"]],
    		htmlObject: "toptableObj",
    		executeAtStart: true,
  		postExecution: function(){
   					$("#toptableObjTable th").css("background-color", darkOrange);
   					$("#toptableObjTable th").css("color",white);
   					$("#toptableObjTable td").css("background-color",topTableRows);
   					$("#toptableObjTable td").css("color",black);
   					$("#toptableObjTable td:nth-child(1)").css("font-weight","bold");
   					$("#toptableObjTable td:nth-child(1)").css("text-align","right");
   					$("#toptableObjTable_wrapper").removeClass("dataTables_wrapper");
  				}

  };


var remainingBranchesCollection =
	{
 		name: "remainingBranchesCollection",
		type: "tableComponent",
    		chartDefinition: MetaLayerVar.branchDef,
		parameters: [["currentDate","currentDate"], ["limit", "5"]],
		cdaParams: [["currentDate","currentDate"], ["limit", "5"]],
    		htmlObject: "top5CollectionObj",
    		executeAtStart: true,
  		postExecution: function(){
					$("#top5CollectionObj td:nth-child(2)").each(function(index) {
						var linkBranchName = '<a href="#" onclick="alert(' + "'" + $(this).text() + "'" + ');return false;">' + $(this).text() + '</a>';
						$(this).html(linkBranchName);
  					});
   					$("#top5CollectionObj th").addClass("tableHeading");
   					$("#top5CollectionObj th").css("background-color", darkBlue);
   					$("#top5CollectionObj th").css("color", white);
   					$("#top5CollectionObj th:nth-child(1)").hide();
   					$("#top5CollectionObj td:nth-child(1)").hide();
   					$("#top5CollectionObjTable_wrapper").removeClass("dataTables_wrapper");

					$("#top5CollectionObj").css("color", black);
					$("#top5CollectionObj tbody tr").each(function(index) {
						if ($(this).hasClass("odd"))
						{
							$(this).css("background-color", oddRow);
						}
						else
						{
							$(this).css("background-color", evenRow);
						}				
  					});
  				}
  };


var remainingBranchesDisbursement =
	{
 		name: "remainingBranchesDisbursement",
		type: "tableComponent",
    		chartDefinition: MetaLayerVar.branchDefDisb,
		parameters: [["currentDate","currentDate"], ["limit", "5"]],
		cdaParams: [["currentDate","currentDate"], ["limit", "5"]],
    		htmlObject: "top5DisbursementObj",
    		executeAtStart: true,
  		postExecution: function(){
					$("#top5DisbursementObj td:nth-child(2)").each(function(index) {
						var linkBranchName = '<a href="#" onclick="alert(' + "'" + $(this).text() + "'" + ');return false;">' + $(this).text() + '</a>';
						$(this).html(linkBranchName);
  					});
   					$("#top5DisbursementObj th").css("background-color", darkBlue);
   					$("#top5DisbursementObj th").css("color", white);
   					$("#top5DisbursementObj th:nth-child(1)").hide();
   					$("#top5DisbursementObj td:nth-child(1)").hide();
   					$("#top5DisbursementObjTable_wrapper").removeClass("dataTables_wrapper");

					$("#top5DisbursementObj").css("color", black);
					$("#top5DisbursementObj tbody tr").each(function(index) {
						if ($(this).hasClass("odd"))
						{
							$(this).css("background-color", oddRow);
						}
						else
						{
							$(this).css("background-color", evenRow);
						}				
  					});

  				}
  };



//

Dashboards.init([toptable, collection, disbursement, remainingBranchesCollection, remainingBranchesDisbursement]);

$(document).ready(function() {

   	$(".sectionTable > tbody > tr:nth-child(1)").css("background-color", lighterOrange);
   	$(".sectionTable > tbody > tr:nth-child(1) > td").css("border-bottom-style","solid");
   	$(".sectionTable > tbody > tr:nth-child(1) > td").css("border-width","1px");
   	$(".sectionTable > tbody > tr:nth-child(1) > td").css("border-color", darkOrange);
   	$(".sectionTable > tbody > tr:nth-child(1) > td").css("padding-top", "5px");
   	$(".sectionTable > tbody > tr:nth-child(1) > td").css("padding-bottom", "5px");

   	$(".borderSection").css("border-color", darkOrange);


	$("#burndown").slideToggle("slow");
});

</script>
