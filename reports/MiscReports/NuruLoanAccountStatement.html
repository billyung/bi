<div class=reportBuffer>
<table width="100%">
<tr>
<td><div class=reportLabel>Start Date</div><div id=date1Obj></div></td><td width="20">&nbsp;</td>
<td><div class=reportLabel>End Date</div><div id=date2Obj></div></td><td width="20">&nbsp;</td>
<td><div class=reportLabel>Loan External Id</div><div id=externalIdObj></div></td>
</tr>
<tr>
<td colspan="5"><div id=externalIdAccountObj></div></td>
</tr>
</table>

<div id=fullStatement>
<table class="fullBorder" width="100%">
<tr><td class="bottomBorder"><div id=headerReportObj></div></td></tr>
<tr><td><div id=theReportObj></div></td></tr>
</table>
</div>

</div>

<script language="javascript" type="text/javascript">

  var dbMetaDataVar = {
    loanAccountDef: {
      colHeaders: ["Txn Date", "Txn Type", "Payment", "Receipt No.", "Receipt Date", "Paid", "Principal", "Interest", "Fees / Charges / Penalties", "Principal Balance", "Interest Balance", "Fees / Charges / Penalties Balance", "Total Balance"],
      colTypes: ['string','string','string','string','string','string','string','string','string','string','string','string','string'],
      tableStyle: "classic",
	paginate: false,
	sort: false,
	filter: false,
	info: false,
      dataAccessId: "getLoanAccountStatement", 
	path: cdaPath
    },
    loanAccountHeaderDef: {
      colHeaders: ["Loan Product", "Disbursed", "Loan Amount", "Loan External ID", "Account No."],
      colTypes: ['string','string','string','string','string'],
      tableStyle: "classic",
	paginate: false,
	sort: false,
	filter: false,
	info: false,
      dataAccessId: "getLoanHeader", 
	path: cdaPath
    } 

  };

function checkAccountSelector()
{

var cntOptions = $('#externalIdAccountObj option').size();
//alert(cntOptions + " : " + accountId); 

switch (cntOptions){
	case 1: 
  		$('#externalIdAccountObj').html("No Accounts to Select");
		accountId = -5;
  		break;

	case 2: 
		$('#externalIdAccountObj select option:eq(1)').attr('selected', 'selected'); 
		accountId = $('#externalIdAccountObj select option:selected').val();
		runTheReport();
  		break;
	default : 	
		$('#externalIdAccountObj select option:eq(0)').attr('selected', 'selected'); 
		accountId = $('#externalIdAccountObj select option:selected').val();
	}
}

function runTheReport()
{
    if (accountId < 0)
    {
        // just ignore as the "select one" option is picked 
        return;
    }

    loanEvent = loanEvent + 1;
    Dashboards.fireChange("loanEvent", loanEvent);
    
}

function runTheStatement()
{
    startDate = $('#date1Obj input').val();
    endDate = $('#date2Obj input').val();

    if (invalidDate(startDate))
    {
        alert("Start Date: " + startDate + " is Invalid");
        return;
    }
    if (invalidDate(endDate))
    {
        alert("End Date: " + endDate + " is Invalid");
        return;
    }

    if (startDate > endDate)
    {
        alert("Start Date is after End Date");
        return;
    }

    if (startDate < disbursedDate)
    {
		startDate = disbursedDate;
    		if (startDate > endDate)
    		{
        		alert("Disbursed Date is after End Date");
			$('#theReportObj').html("");
        		return;
    		}
    }
    loanEventStatement = loanEventStatement + 1;
    Dashboards.fireChange("loanEventStatement", loanEventStatement);
    
}

externalId = 
{
	name: "externalId",
	type: "textInputComponent",
	parameters:[],
	parameter: "extId",
	htmlObject: "externalIdObj",
	executeAtStart: true,
	postChange: function(){
					//Dashboards.fireChange("extId", extId);
					}
};
 
date1 = 
{
	name: "date1",
	type: "dateInputComponent",
	parameters:[],
	parameter: "startDate",
	htmlObject: "date1Obj",
	executeAtStart: true,
	postChange: function(){ runTheReport();}

};

date2 = 
{
	name: "date2",
	type: "dateInputComponent",
	parameters:[],
	parameter: "endDate",
	htmlObject: "date2Obj",
	executeAtStart: true,
	postChange: function(){ runTheReport();}

};

var externalIdAccount =
	{
 		name: "externalIdAccount",
		type: "select",
     		queryDefinition: { dataAccessId: "getLoanIdFromExternalId", path: cdaPath },
  		listeners:["extId"],
		valueAsId: false,
		parameters: [["externalId","extId"]],
		cdaParams: [["externalId","extId"]],
		parameter: "accountId",
    		htmlObject: "externalIdAccountObj",
    		executeAtStart: false,
		postExecution: function(){	clearReport();
							checkAccountSelector();},
		postChange: function(){		clearReport();
							runTheReport();}
  };


var loanAccountHeader =
	{
 		name: "loanAccountHeader",
		type: "tableComponent",
    		chartDefinition: dbMetaDataVar.loanAccountHeaderDef,
  		listeners:["loanEvent"],
		parameters: [["accountId","accountId"]],
		cdaParams: [["accountId","accountId"]],
    		htmlObject: "headerReportObj",
    		executeAtStart: false,
  		postExecution: function(){ tidyLoanHeaderTable()}
  };

var loanAccount =
	{
 		name: "loanAccount",
		type: "tableComponent",
    		chartDefinition: dbMetaDataVar.loanAccountDef,
  		listeners:["loanEventStatement"],
		parameters: [["startDate","startDate"], ["endDate","endDate"], ["accountId","accountId"]],
		cdaParams: [["startDate","startDate"], ["endDate","endDate"], ["accountId","accountId"]],
    		htmlObject: "theReportObj",
    		executeAtStart: false,
  		postExecution: function(){ tidyLoanTable()}
  };

Dashboards.init([externalId, externalIdAccount , date1, date2, loanAccountHeader, loanAccount]);

$(document).ready(function() {
});

</script>
