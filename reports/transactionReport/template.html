<script language="javascript" type="text/javascript">

var currentDate = new Date();
var month = currentDate.getMonth() + 1;
var fromDate = currentDate.getFullYear() + "-" + month + "-" + currentDate.getDate();
var toDate = currentDate.getFullYear() + "-" + month + "-" + currentDate.getDate();
var branch_id = -5;
var transaction_type_id = -5;
var user_id = -5;
var report_type = "detail";
var outputType = "application/pdf";

Dashboards.globalcontext = false;

var solution = Dashboards.getQueryParameter("solution");
var path = Dashboards.getQueryParameter("path");

var event = 0;

function runTheReport()
{
	if (fromDate > toDate)
	{
		alert("From Date is after To Date");
		return;
	} else if ( branch_id == -5 ||  transaction_type_id == -5 || user_id == -5 ) 
        {
               alert("Please select appropriate values");
	       return;
        }

	event = event + 1;
	Dashboards.fireChange("event", event);
}

selectUser = 
{
	name:                "selectUser",
	type:                "select",
	parameter:           "user_id",
	valueAsId:           false,
        queryDefinition:     { dataAccessId: "getMifosUsers", path: "dataAccess/sql-jndi.cda" },
	htmlObject:          "selectUserObject",
	executeAtStart:      true
};

selectBranch = 
{
	name:                "selectBranch",
	type:                "select",
	parameter:           "branch_id",
	valueAsId:           false,
        queryDefinition: { dataAccessId: "getBranches", path: "dataAccess/sql-jndi.cda" },
	htmlObject: "selectBranchObject",
	executeAtStart: true
};

selectTransactionType = 
{
	name: "selectTransactionType",
	type: "select",
	parameter: "transaction_type_id",
	valueAsId: false,
        queryDefinition: { dataAccessId: "getTransactionTypes", path: "dataAccess/sql-jndi.cda" },
	htmlObject: "selectTransactionTypeObject",
	executeAtStart: true
};

selectFromDate = 
{
	name: "selectFromDate",
	type: "dateInput",
	parameters:[],
	parameter: "fromDate",
	htmlObject: "selectFromDateObject",
        dateFormat: "yy-mm-dd",
	startDate: "2006-05-31",
	endDate: "TODAY",
	executeAtStart: true,
	tooltip: "Click me to select a date"
};


selectToDate = 
{
	name: "selectToDate",
	type: "dateInput",
	parameters:[],
	parameter: "toDate",
	htmlObject: "selectToDateObject",
        dateFormat: "yy-mm-dd",
	startDate: "2006-05-31",
	endDate: "TODAY",
	executeAtStart: true,
	tooltip: "Click me to select a date"
};


outputSelector = 
{
	name: "outputSelector",
	type: "select",
	parameters:[],
	valuesArray:[["application/pdf","PDF"], ["text/html","HTML"], ["application/vnd.ms-excel","EXCEL"]],
	parameter:"outputType",
	valueAsId: false,
	htmlObject: "outputSelectorObj",
	executeAtStart: true
}

runReport = 
{
  	name: "runReport",
  	type: "Button",
  	htmlObject: "runReportObj",
  	label: "View Report",
  	expression: function(){runTheReport();},
  	executeAtStart: true
}

clearReport = 
{
  	name: "clearReport",
  	type: "Button",
  	htmlObject: "clearReportObj",
  	label: "Clear Report",
  	expression: function(){$('#theReportObj').html("");},
  	executeAtStart: true
}

selectReport = 
{
	name: "selectReport",
	type: "select",
	parameter: "report_type",
	valueAsId: false,
        valuesArray: [["detail","Detail"],["summary","Summary"]],
	htmlObject: "selectReportObject",
	executeAtStart: true
};

theReport = 
{
  	name: "theReport",
  	type: "prpt",
        listeners:["event"],
  	solution: solution,
  	path: path,
  	action: "",
  	parameters: [["from_date","fromDate"],["to_date","toDate"],["p_branch_id","branch_id"],["p_user_id","user_id"],["p_trans_type_id","transaction_type_id"],["output-type","outputType"]],
  	htmlObject: "theReportObj",
  	executeAtStart: false,
  	paginate: false,
       // iframe: false,
	showParameters: false,
        preExecution:function(){
  	                     if(report_type == "detail") { 
                              this.action = "Detail.prpt"; 
                             } else {
                              this.action = "Summary.prpt";
                             }
                           }
}

function load(){
      Dashboards.init([selectUser,selectBranch,selectTransactionType,selectFromDate,selectToDate,outputSelector,runReport,clearReport,selectReport,theReport]);
}

load();

</script>
<table>
	<tr>
		<td> From Date: <div id="selectFromDateObject"></div> </td>
		<td>To Date: <div id="selectToDateObject"></div> </td>
		<td>Branch Office: <div id="selectBranchObject"></div> </td>
		<td>Transaction Type: <div id="selectTransactionTypeObject"></div> </td>
		<td>Personnel: <div id="selectUserObject"></div> </td>
                <td>Report Type: <div id="selectReportObject"></div> </td>
		<td><div class=reportLabel>Output Type</div><div id=outputSelectorObj></div> </td>
		<td><div id=clearReportObj></div> </td><td> <div id=runReportObj></div> </td>
	</tr>
</table>
		<div id=theReportObj></div> 
